/*Porównaj wartoœci szkód z tego (obecnego) miesi¹ca, z tym samym miesi¹cem 
poprzedniego roku, oraz tego samego miesi¹ca sprzed 2 lat*/

WITH MEMBER [Last Year] AS '(PARALLELPERIOD([ID Data Zakonczenia Postepowania].[Hierarchy].[Rok], 1,
                        [ID Data Zakonczenia Postepowania].[Hierarchy].CurrentMember), 
                        [Measures].[Wartosc Odszkodowania])'
                        
MEMBER [Two years ago] AS '(PARALLELPERIOD([ID Data Zakonczenia Postepowania].[Hierarchy].[Rok], 2,
                        [ID Data Zakonczenia Postepowania].[Hierarchy].CurrentMember), 
                        [Measures].[Wartosc Odszkodowania])'

MEMBER [Measures].[This Year] AS [Measures].[Wartosc Odszkodowania]

SELECT { 
    [ID Data Zakonczenia Postepowania].[Hierarchy].[Rok].[2025].[January] 
    } 
 ON ROWS,
{[This Year], [Last Year], [Two years ago]} ON COLUMNS
FROM [HurtowniaDanychRel_cube1];


/*Porównaj ró¿nice w iloœci postêpowañ zakoñczonych odmow¹ pomiêdzy
s¹siednimi miesi¹cami dla ostatnich 3 lat*/

-- TODO !!!!!!!!!!!!!!!!!!!!!!!!!!!!

//Poka¿ typy ubezpieczeñ najczêœciej wyp³acanych dla ubieg³ego miesi¹ca

SELECT {
    [ID Data Zakonczenia Postepowania].[Miesiac].CurrentMember.PrevMember,
TOPCOUNT(
        EXCEPT(
            [Odszkodowanie].[Rodzaj Odszkodowania].Children,
            {
                [Odszkodowanie].[Rodzaj Odszkodowania].[Nie przyznane],
                [Odszkodowanie].[Rodzaj Odszkodowania].[All],
                [Odszkodowanie].[Rodzaj Odszkodowania].[Unknown]
            }
        ),3,
        (
            [ID Data Zakonczenia Postepowania].[Miesiac].CurrentMember.PrevMember,
            [Measures].[Ilosc przeprowadzonych postepowan]
        )
    )
} ON ROWS,
    [Measures].[Ilosc przeprowadzonych postepowan] ON COLUMNS
FROM [HurtowniaDanychRel_cube1]

/*Porównaj iloœci dostarczonych dokumentów, których autorem jest klient pomiêdzy 
postêpowaniami rozpoczêtymi w s¹siednich miesi¹cach w ci¹gu ostatnich 5 lat */

-- autor in Dokumentacja ZAWIERA SIE w pelnie_imienazwisko w Klient
-- ilosc dokumentow dla autora w Dokumentacja
-- smth like this? (PARALLELPERIOD([Sale Date].[Date Hierarchy].[Month], 1, [Sale Date].[Date Hierarchy].CurrentMember), [Measures].[Number of book copies sold])'

--FIXME !!!!!!!!!!!!!!!!1

WITH 
MEMBER [Measures].[DocumentsByClients] AS
    SUM(
        EXISTS(
            [Dokumentacja].[ID Dokumentacja].Members,
            [Klient].[Pelne_ImieNazwisko].Members,
            "Dokumentacja"
        ),
        [Measures].[Ilosc dokumentow]
    )

SELECT
    {
        [Measures].[DocumentsByClients]
    } ON COLUMNS,

    [ID Data Rozpoczecia Postepowania].[Hierarchy].[Miesiac].Members ON ROWS

FROM [HurtowniaDanychRel_cube1]

-- TODO

/*Porównaj procent dokumentów dla ka¿dego typu dokumentu, których autorem nie jest 
klient pomiêdzy postêpowaniami rozpoczêtymi w s¹siednich miesi¹cach w ci¹gu ostatnich 2 lat*/

-- autor in Dokumentacja ZAWIERA SIE w pelnie_imienazwisko w Klient
-- ilosc dokumentow dla autora w Dokumentacja
-- calkowita ilosc dokumentow to measure w Postepowanie

-- TODO

/*Jaka jest œrednia wysokoœæ wyp³aconego odszkodowania dla polis rozpoczynaj¹cych siê w kolejnych miesi¹cach?*/

-- The date dimension is my biggest enemy during these labs. Nothing about it works ever
-- everything is done per instruction, and yet i cannot just make it work
-- this is the simplest way for it to do the months properly unfortunately

WITH 
MEMBER [Measures].[Jan] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 1
    ), [Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Feb] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 2
    ), [Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Mar] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 3
    ), [Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Apr] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 4
    ),[Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[May] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 5
    ),[Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Jun] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 6
    ),[Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Jul] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 7
    ), [Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Aug] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 8
    ),[Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Sep] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 9
    ),[Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Oct] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 10
    ),[Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Nov] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 11
    ),[Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"
MEMBER [Measures].[Dec] AS
AVG(
    Filter(
        [ID Data Rozpoczecia Polisy].[Miesiac].Members,
        [ID Data Rozpoczecia Polisy].[Miesiac].CurrentMember.Properties("Miesiac Numer", TYPED) = 12
    ),[Measures].[Wartosc Odszkodowania]), FORMAT_STRING = "0.00"

SELECT
{
    [Measures].[Jan], [Measures].[Feb], [Measures].[Mar], [Measures].[Apr], [Measures].[May], [Measures].[Jun],
    [Measures].[Jul], [Measures].[Aug], [Measures].[Sep], [Measures].[Oct], [Measures].[Nov], [Measures].[Dec]
} ON COLUMNS
FROM [HurtowniaDanychRel_cube1]


//Porównaj najmniejsze i najwiêksze wyp³acone kwoty odszkodowania dla ka¿dej kategorii polisy

SELECT {
    [Measures].[Najmniejsza wyplacona kwota],[Measures].[Najwieksza wyplacona kwota]
} ON COLUMNS,
EXCEPT(
    [Polisa].[Kategoria].Members,
    { [Polisa].[Kategoria].[All] }
) ON ROWS
FROM [HurtowniaDanychRel_cube1]


/*Porównaj œredni¹ ca³kowit¹ wysokoœæ wyp³aconego odszkodowania przez ostatni 
rok dla danego klienta w zale¿noœci od iloœci wykupionych przez niego polis*/
-- I'm like 95% sure this is definied in a way that is impossible to do in mdx 
--(or i just don't know how to do that completely)

/*Porownaj ilosc analitykow i ilosc dokumentow dla postepowan majacych miejsce na skutek kazdego 
typu zdarzenia*/

SELECT
    {[Measures].[Ilosc Analitykow], [Measures].[Ilosc Dokumentow]} ON COLUMNS,
    ORDER(
        EXCEPT(
            [Zdarzenie].[Rodzaj].Members,
            { [Zdarzenie].[Rodzaj].[All] }
        ),
        [Measures].[Ilosc Dokumentow],
        ASC
    ) ON ROWS
FROM [HurtowniaDanychRel_cube1]


/*W postêpowaniach zwi¹zanych z któr¹ z kategori¹ polisy klienci najszybciej 
dostarczali dokumenty przez ostatnie 2 lata?*/


WITH 
MEMBER [Measures].[lastYear] AS
AVG(
    Filter(
        [ID Data Zakonczenia Postepowania].[Rok].Members,
        [ID Data Zakonczenia Postepowania].[Rok].CurrentMember.Name = "2024"
    ), [Measures].[Ilosc Dokumentow]
), FORMAT_STRING = "0.00"

MEMBER [Measures].[thisYear] AS
AVG(
    Filter(
        [ID Data Zakonczenia Postepowania].[Rok].Members,
        [ID Data Zakonczenia Postepowania].[Rok].CurrentMember.Name = "2025"
    ), [Measures].[Ilosc Dokumentow]
), FORMAT_STRING = "0.00"

MEMBER [Measures].[averageTwoYears] AS
([Measures].[lastYear] + [Measures].[thisYear]) / 2, 
FORMAT_STRING = "0.00"

SELECT 
{ [Measures].[thisYear], [Measures].[lastYear], [Measures].[averageTwoYears] } ON COLUMNS,
ORDER(
    EXCEPT(
        [Polisa].[Kategoria].Members,
        { [Polisa].[Kategoria].[All] }
    ),
    [Measures].[averageTwoYears],
    DESC
) ON ROWS
FROM [HurtowniaDanychRel_cube1]
WHERE ( [Dokumentacja].[Srednie Opoznienie].&[ponizej tygodnia] )


/*Jaka jest œrednia iloœæ dokumentów dostarczonych 2 tygodnie po rozpoczêciu 
postêpowania dla ka¿dej z kategorii polis?*/

WITH 
MEMBER [Measures].[AvgIloscDokumentow] AS
AVG(
    [Dokumentacja].[ID Dokumentacja].Members,
    [Measures].[Ilosc Dokumentow]
),
FORMAT_STRING = "0.00"

SELECT [Measures].[AvgIloscDokumentow] ON COLUMNS,
EXCEPT(
    [Polisa].[Kategoria].Members,
    { [Polisa].[Kategoria].[All] }
) ON ROWS
FROM [HurtowniaDanychRel_cube1]
WHERE ( [Dokumentacja].[Srednie Opoznienie].&[tydzien - 2 tygodnie] )



